# 法規生成功能說明

## 概述

本系統新增了管理員從法規生成待審核資料的功能，讓管理員能夠選取現有的法規條文，使用AI自動生成符合法規要求的訓練資料。

## 功能流程

### 1. 選取法規
- 管理員在待審核資料集管理頁面點擊「從法規生成」按鈕
- 系統載入所有可用的法規條文
- 管理員可以多選法規條文（支援複選）
- 選取的法規會顯示在右側的已選區域

### 2. 生成資料
- 選取法規後直接點擊「生成資料」按鈕
- AI會根據選取的法規自動生成所有欄位：
  - **指令 (Instruction)**: AI自動生成清楚明確的指令
  - **輸入 (Input)**: AI模擬一般用戶的提問
  - **輸出 (Output)**: AI提供專業且準確的回答
  - **系統提示 (System)**: AI設定適當的角色和行為準則

### 3. 確認或重新生成
- 顯示生成的完整內容（instruction、input、output、system、source）
- 管理員可以選擇：
  - **確認加入**: 將生成的資料保存到資料庫
  - **重新生成**: 使用相同法規重新生成
  - **取消**: 關閉模態框，不保存資料



## 技術實現

### 後端API

#### 1. 生成資料端點
```python
@router.post("/generate-from-regulations", response_model=schemas.GeneratedDataset)
async def generate_dataset_from_regulations(
    request: schemas.GenerateFromRegulationsRequest,
    db: Session = Depends(get_db),
    admin_user: models.User = Depends(get_current_admin_user)
):
    """
    Generate a new dataset from selected legal regulations using Ollama.
    Only accessible by admin users.
    """
```

#### 2. 確認保存端點
```python
@router.post("/confirm-generated", response_model=schemas.RawDataset)
def confirm_generated_dataset(
    dataset: schemas.RawDatasetCreate,
    db: Session = Depends(get_db),
    admin_user: models.User = Depends(get_current_admin_user)
):
    """
    Confirm and save a generated dataset to the database.
    Only accessible by admin users.
    """
```

### 前端實現

#### 1. 法規選擇界面
- 雙欄佈局：左側可選法規，右側已選法規
- 支援複選和單擊選擇
- 即時顯示選取狀態
- 可移除已選法規

#### 2. 生成流程
- 簡化的操作流程
- 一鍵生成所有欄位
- 清晰的進度指示

#### 3. 結果展示
- 分欄顯示生成內容和資料來源
- 支援長文本的預覽
- 美觀的卡片式佈局

## 資料結構

### 生成請求格式
```json
{
  "selected_article_ids": [1, 2, 3]
}
```

### 生成回應格式
```json
{
  "instruction": "這個資安獎懲辦法是根據什麼法律訂出來的？",
  "input": "為什麼政府要特別訂資安獎懲規定？",
  "output": "這是根據《資通安全管理法》第15條與第19條訂定的...",
  "system": "說明本辦法與母法的法律關係。",
  "history": [],
  "source": ["公務機關所屬人員資通安全事項獎懲辦法第1條"]
}
```

## 使用範例

### 1. 基本使用
1. 登入管理員帳號
2. 進入「待審核資料集管理」頁面
3. 點擊「從法規生成」按鈕
4. 選擇相關的法規條文
5. 點擊「生成資料」
6. 檢查生成結果
7. 點擊「確認加入」

### 2. 進階使用
- 選擇多個相關法規條文
- 多次重新生成直到滿意
- 根據生成結果調整法規選擇

## 權限控制

- 只有管理員用戶可以訪問此功能
- 需要有效的認證token
- 法規查詢API對所有認證用戶開放

## 錯誤處理

### 1. 法規選擇錯誤
- 未選擇任何法規：顯示「請選擇至少一個法規條文」
- 法規載入失敗：顯示錯誤訊息並提供重試選項

### 2. 生成參數錯誤
- 未選擇法規：顯示「請選擇至少一個法規條文」
- 法規載入失敗：顯示具體的錯誤訊息

### 3. 生成過程錯誤
- 網路錯誤：顯示「生成資料失敗」並提供重試
- AI服務錯誤：顯示具體的錯誤原因
- 超時錯誤：自動重試或提示用戶重試

## 性能優化

### 1. 法規載入
- 一次性載入所有法規，避免重複請求
- 使用虛擬滾動處理大量法規
- 本地快取法規資料

### 2. 生成過程
- 顯示載入動畫提供用戶反饋
- 非阻塞式生成，不影響其他操作
- 錯誤時自動回退到第一步驟

### 3. 界面響應
- 使用Vue的響應式系統
- 即時更新選取狀態
- 平滑的過渡動畫

## 擴展性

### 1. 支援更多法規格式
- 可以輕鬆擴展支援其他法規引用格式
- 支援法規版本控制
- 支援法規分類和標籤

### 2. 生成參數擴展
- 支援更多AI模型參數
- 支援生成多筆資料
- 支援批量生成和確認

### 3. 結果處理擴展
- 支援直接編輯生成結果
- 支援模板化生成
- 支援歷史記錄和版本管理

## 注意事項

1. **法規資料完整性**: 確保法規資料庫包含所有需要的法規條文
2. **AI服務穩定性**: 需要穩定的Ollama服務連接
3. **生成品質**: 生成的內容需要人工審核和調整
4. **資料一致性**: 確保生成的資料符合系統的資料格式要求

## 未來改進

1. **智能法規推薦**: 根據指令自動推薦相關法規
2. **生成模板**: 提供預設的生成模板
3. **批量生成**: 支援一次生成多筆資料
4. **生成歷史**: 記錄和管理生成歷史
5. **品質評估**: 自動評估生成內容的品質 